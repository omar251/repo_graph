<!DOCTYPE html>
<html>
<head>
    <title>Node Spacing Test</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        #network { width: 800px; height: 600px; border: 1px solid #ccc; }
        .controls { margin: 10px 0; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h2>Node Spacing Test - Before vs After</h2>
    <div class="controls">
        <button onclick="loadOldConfig()">Old Physics (Collapsed)</button>
        <button onclick="loadNewConfig()">New Physics (Spaced)</button>
        <button onclick="resetView()">Reset View</button>
    </div>
    <div id="network"></div>

    <script>
        let network;
        let nodes, edges;

        // Sample data with multiple nodes to test spacing
        const sampleData = {
            nodes: [
                {id: 1, label: "main.js", type: "js", size: 25},
                {id: 2, label: "utils.js", type: "js", size: 20},
                {id: 3, label: "config.js", type: "js", size: 20},
                {id: 4, label: "api.js", type: "js", size: 20},
                {id: 5, label: "helper.js", type: "js", size: 20},
                {id: 6, label: "external-lib", type: "external", size: 15, external: true},
                {id: 7, label: "component.jsx", type: "jsx", size: 25},
                {id: 8, label: "types.ts", type: "ts", size: 20},
                {id: 9, label: "missing-dep", type: "missing", size: 15}
            ],
            edges: [
                {from: 1, to: 2}, {from: 1, to: 3}, {from: 1, to: 4},
                {from: 2, to: 5}, {from: 3, to: 6}, {from: 4, to: 7},
                {from: 7, to: 8}, {from: 8, to: 9}, {from: 5, to: 6}
            ]
        };

        function getNodeColor(type, external = false) {
            if (external) return "#dc3545";
            if (type === "missing") return "#ffc107";
            const colors = {
                js: "#f7df1e", jsx: "#61dafb", ts: "#3178c6", 
                tsx: "#61dafb", py: "#3776ab", unknown: "#6c757d"
            };
            return colors[type] || colors.unknown;
        }

        function processNodes(data) {
            return data.nodes.map(node => ({
                id: node.id,
                label: node.label,
                color: {
                    background: getNodeColor(node.type, node.external),
                    border: node.type === "missing" ? "#dc3545" : "#fff"
                },
                shape: node.external ? "box" : (node.type === "missing" ? "triangle" : "dot"),
                size: node.size,
                font: { size: 12, color: "#333" }
            }));
        }

        function processEdges(data) {
            return data.edges.map(edge => ({
                from: edge.from,
                to: edge.to,
                arrows: "to",
                color: { color: "#848484", opacity: 0.7 },
                width: 1.5
            }));
        }

        function loadOldConfig() {
            console.log("Loading old physics config (nodes will collapse)");
            const options = {
                nodes: { borderWidth: 2, margin: 10 },
                edges: { smooth: { enabled: true, type: "continuous" } },
                physics: {
                    enabled: true,
                    forceAtlas2Based: {
                        gravitationalConstant: -50,
                        centralGravity: 0.01,
                        springLength: 200,
                        springConstant: 0.08,
                        damping: 0.4,
                        avoidOverlap: 0.5,
                    },
                    maxVelocity: 50,
                    solver: "forceAtlas2Based",
                    timestep: 0.35,
                    stabilization: { iterations: 150, updateInterval: 25 }
                }
            };
            initNetwork(options);
        }

        function loadNewConfig() {
            console.log("Loading new physics config (nodes will be spaced)");
            const options = {
                nodes: {
                    borderWidth: 2,
                    margin: 20,
                    scaling: { min: 15, max: 40 },
                    font: { size: 12, color: "#333" }
                },
                edges: {
                    smooth: { enabled: true, type: "continuous", roundness: 0.3 },
                    width: 1.5,
                    length: 350,
                    physics: true
                },
                physics: {
                    enabled: true,
                    barnesHut: {
                        gravitationalConstant: -3000,
                        centralGravity: 0.1,
                        springLength: 400,
                        springConstant: 0.02,
                        damping: 0.15,
                        avoidOverlap: 1.5
                    },
                    maxVelocity: 30,
                    minVelocity: 0.1,
                    solver: "barnesHut",
                    timestep: 0.5,
                    stabilization: {
                        iterations: 300,
                        updateInterval: 50,
                        onlyDynamicEdges: false,
                        fit: true
                    },
                    adaptiveTimestep: true
                }
            };
            initNetwork(options);
        }

        function initNetwork(options) {
            const container = document.getElementById('network');
            nodes = new vis.DataSet(processNodes(sampleData));
            edges = new vis.DataSet(processEdges(sampleData));
            
            network = new vis.Network(container, {nodes, edges}, options);
            
            network.on("stabilizationIterationsDone", () => {
                network.setOptions({ physics: { enabled: false } });
                network.fit();
            });
        }

        function resetView() {
            if (network) {
                network.fit();
            }
        }

        // Load new config by default
        window.onload = () => loadNewConfig();
    </script>
</body>
</html>